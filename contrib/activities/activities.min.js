var aMinute=6E4,twoMinutes=12E4,anHour=36E5,twoHours=72E5,aDay=864E5,twoDays=1728E5,aWeek=6048E5,twoWeeks=12096E5,url="/cgi-bin/activities.cgi",nMin=7,nMax=100,nSel=nMin,interval=1E4,intervalId;
function toWhenString(a){a=new Date(1E3*a);var c=new Date-a;c<aMinute?a="just now":c<twoMinutes?a="a minute ago":c<twoHours?(a=c.valueOf()/aMinute,a=Math.floor(a)+" minutes ago"):c<twoDays?(a=c.valueOf()/anHour,a=Math.floor(a)+" hours ago"):c<twoWeeks?(a=c.valueOf()/aDay,a=Math.floor(a)+" days ago"):a=a.toLocaleDateString();return a}function toRefString(a,c){var d;return d=!0==/^refs\/tags\//.test(a)?(c?"":"tag ")+a.replace("refs/tags/",""):(c?"":"branch ")+a}
function pushKind(a,c){var d=0;"0000000000000000000000000000000000000000"==a&&"0000000000000000000000000000000000000000"!=c?d=1:"0000000000000000000000000000000000000000"!=a&&"0000000000000000000000000000000000000000"==c&&(d=2);return d}function getOptions(){return $.getJSON(url,{a:"opt"},function(a){$.each(a,function(a,d){switch(a){case "min":nMin=nSel=d;break;case "max":nMax=d;break;case "interval":interval=d}})})}
function updateActivity(){$.getJSON(url,{a:"log",n:nSel},function(a){var c=[],d,h,e,f,g;$.each(a,function(a,b){d=' <i class="gl-time">'+toWhenString(b.timestamp)+"</i>";h='<i class="gl-user">'+b.user+"</i> ";switch(b.action){case "fork":e='forked a new repo <a href="?p='+b.repo+'.git">'+b.repo+"</a>";break;case "create":e='created a new repo <a href="?p='+b.repo+'.git">'+b.repo+"</a>";break;case "push":switch(pushKind(b.oldSha,b.newSha)){case 1:f="created "+toRefString(b.ref,!1)+" at ";g='<a href="?p='+
b.repo+".git;h="+b.newSha+'">'+b.repo+"</a>";break;case 2:f="deleted "+toRefString(b.ref,!1)+" at ";g='<a href="?p='+b.repo+'.git">'+b.repo+"</a>";break;default:f="pushed to "+toRefString(b.ref,!0)+" at ",g='<a href="?p='+b.repo+".git;h="+b.newSha+'">'+b.repo+"</a>"}e=f.concat(g);break;default:e="did something unexpected (<i>internal error</i>)"}c.push("<li>"+h+e+d+"</li>")});c.reverse();$("#gl-title").filter(":hidden").css("display","block");$("#gl-showall").filter(":hidden").css("display","block");
$("#gl-activities-listing").html(function(){return c.join("")});$("#gl-activities li").filter(function(a){return 0<a}).addClass("gl-sep")})}function toggleActivityCount(){nSel=nSel===nMin?nMax:nMin;nSel==nMin?$("#gl-showall").text("more").attr("title","show more events"):$("#gl-showall").text("less").attr("title","show less events")}function stopActivityUpdate(){void 0!==intervalId&&clearInterval(intervalId)}
function startActivityUpdate(){updateActivity();intervalId=setInterval(updateActivity,interval)}function activities(){$("#gl-showall").click(function(a){a.preventDefault();stopActivityUpdate();toggleActivityCount();startActivityUpdate()});void 0===intervalId&&getOptions().then(startActivityUpdate)};